
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>How to install Openstack Swift on Amazon AWS - DropMyEmail Blog</title>
  <meta name="author" content="DropMyEmail">

  
  <meta name="description" content="At DropMyEmail, we are evaluating open source private cloud storage solutions. We have found OpenStack Swift to be the best choice in the market &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://engineering.dropmyemail.com/blog/2013/01/24/how-to-install-openstack-swift-on-amazon-aws/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/blog/atom.xml" rel="alternate" title="DropMyEmail Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">DropMyEmail Blog</a></h1>
  
    <h2>engineering blog</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:engineering.dropmyemail.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">How to Install Openstack Swift on Amazon AWS</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-24T12:19:00+08:00" pubdate data-updated="true">Jan 24<span>th</span>, 2013</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>At <a href="http://dropmyemail">DropMyEmail</a>, we are evaluating open source private cloud storage solutions. We have found <a href="http://swift.openstack.org">OpenStack Swift</a> to be the best choice in the market right now. We are documenting the steps to build a prototype swift cluster. Much of the work is from this amazing <a href="http://www.buildcloudstorage.com/2011/10/installing-openstack-swift-cluster-on.html">blog post by Amar</a> and the <a href="http://docs.openstack.org/developer/swift/howto_installmultinode.html">multiple server swift installation</a>. Our setup is largely similar except that we are on a more recent stack.</p>

<h2>Overview</h2>

<p><img src="https://s3.amazonaws.com/static.engineering.dropmyemail.com/DropMyEmail+Prototype+OpenStack+Swift+Cluster.png" title="DropMyEmail Prototype OpenStack Swift Cluster" ></p>

<p>It is a simple architecture. We have a proxy server which acts as the interface for the outside world. The proxy server includes the authentication server. The proxy server is connected to 5 storage nodes. Each storage node includes account, container and object servers. Each node is a single <a href="http://aws.amazon.com/ec2">EC2</a> instance.</p>

<h2>Setting up the instances</h2>

<p>We assume you know how to set up an EC2 instance. Our instance are all <strong>Ubuntu Linux 12.04</strong> images from <a href="http://alestic.com">Alestic</a>.</p>

<p>For the security groups, here are the settings we used for each type of node.</p>

<h3>Security group</h3>

<ul>
<li>Port 22 from source 0.0.0.0/0</li>
<li>Port 43 from source 0.0.0.0/0</li>
<li>Port 6000-6100 from source 0.0.0.0/0</li>
</ul>


<p>For the rest of the article, we&#8217;ll be using the public and private IP addresses of the EC2 instance at different scenarios. Do note <a href="http://aws.amazon.com/articles/1145">the differences</a> betwen them. We&#8217;ll be assuming you are logging into the instance via ssh and running commands.</p>

<h2>Preparing the base Swift image</h2>

<p>We are going to prepare an <a href="https://aws.amazon.com/amis">AMI</a> image with the core Swift software installed.</p>

<p>First we add the swift repository and install the base swift packages.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo add-apt-repository ppa:swift-core/release
</span><span class='line'>sudo apt-get update
</span><span class='line'>sudo apt-get install swift</span></code></pre></td></tr></table></div></figure>


<p>Next we set up the swift configuration files. Create the Swift configuration directory.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo mkdir -p /etc/swift</span></code></pre></td></tr></table></div></figure>


<p>We need to create a random string to act as the hash for Swift. Run the following command, you should see a random string as the result.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo od -t x8 -N 8 -A n &lt;/dev/random</span></code></pre></td></tr></table></div></figure>


<p>Create <strong>/etc/swift/swift.conf</strong>. Add the following lines to it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="k">[swift-hash]</span>
</span><span class='line'><span class="c1"># random unique string that can never change (DO NOT LOSE)</span>
</span><span class='line'><span class="na">swift_hash_path_suffix</span> <span class="o">=</span> <span class="s">&lt;RESULTS FROM ABOVE od COMMAND&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Change the owner to swift.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">sudo</span> <span class="err">chown</span> <span class="err">-R</span> <span class="err">swift:swift</span> <span class="err">/etc/swift</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now save the image as an AMI. This base image can be used for the other instances.</p>

<h2>Setting up the Swift Proxy server</h2>

<p>Now choose one instance for the proxy server. The proxy server contains both the proxy and authentication server. Let us install the proxy server first.</p>

<p>Run these commands to install the dependencies.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">sudo</span> <span class="err">apt-get</span> <span class="err">install</span> <span class="err">swift-proxy</span> <span class="err">memcached</span> <span class="err">swauth</span>
</span></code></pre></td></tr></table></div></figure>


<p>You could use <a href="http://keystone.openstack.org">OpenStack Keystone</a> for authentication. Cons is you need to set up and maintain another system for authentication. Swauth is a self-contained authentication server on the proxy server. If you just want to run Swift on its own, we&#8217;d recommend going with <a href="https://github.com/gholt/swauth">Swauth</a>.</p>

<p>Next we create the SSL cert to encrypt our requests.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">cd</span> <span class="err">/etc/swift</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">openssl</span> <span class="err">req</span> <span class="err">-new</span> <span class="err">-x509</span> <span class="err">-nodes</span> <span class="err">-out</span> <span class="err">cert.crt</span> <span class="err">-keyout</span> <span class="err">cert.key</span>
</span></code></pre></td></tr></table></div></figure>


<p>We need to replace the IP address in the memcached configuration file and then restart memcached. Check the private IP address for the instance and replace the IP with your own. We are <em>assuming</em> it is <strong>10.0.0.0</strong>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="na">sudo export PROXY_LOCAL_NET_IP</span><span class="o">=</span><span class="s">10.0.0.0</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">perl</span> <span class="err">-pi</span> <span class="err">-e</span> <span class="err">&quot;s/-l</span> <span class="err">127.0.0.1/-l</span> <span class="err">$PROXY_LOCAL_NET_IP/&quot;</span> <span class="err">/etc/memcached.conf</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">service</span> <span class="err">memcached</span> <span class="err">restart</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next we need to create the configuration file for the proxy server. Create <strong>/etc/swift/proxy-server.conf</strong> with the following contents. Remember to replace the URL and IP address with those from your instance.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="k">[DEFAULT]</span>
</span><span class='line'><span class="na">bind_port</span> <span class="o">=</span> <span class="s">443</span>
</span><span class='line'><span class="na">cert_file</span> <span class="o">=</span> <span class="s">/etc/swift/cert.crt</span>
</span><span class='line'><span class="na">key_file</span> <span class="o">=</span> <span class="s">/etc/swift/cert.key</span>
</span><span class='line'><span class="na">workers</span> <span class="o">=</span> <span class="s">8</span>
</span><span class='line'><span class="na">user</span> <span class="o">=</span> <span class="s">swift</span>
</span><span class='line'>
</span><span class='line'><span class="k">[pipeline:main]</span>
</span><span class='line'><span class="na">pipeline</span> <span class="o">=</span> <span class="s">healthcheck cache swauth proxy-server</span>
</span><span class='line'>
</span><span class='line'><span class="k">[app:proxy-server]</span>
</span><span class='line'><span class="na">use</span> <span class="o">=</span> <span class="s">egg:swift#proxy</span>
</span><span class='line'><span class="na">allow_account_management</span> <span class="o">=</span> <span class="s">true</span>
</span><span class='line'>
</span><span class='line'><span class="k">[filter:swauth]</span>
</span><span class='line'><span class="na">use</span> <span class="o">=</span> <span class="s">egg:swauth#swauth</span>
</span><span class='line'><span class="na">set log_name</span> <span class="o">=</span> <span class="s">swauth</span>
</span><span class='line'><span class="na">super_admin_key</span> <span class="o">=</span> <span class="s">swauthkey</span>
</span><span class='line'><span class="na">default_swift_cluster</span> <span class="o">=</span> <span class="s">cluster_name#https://ec2-1-2-3-4.compute-1.amazonaws.com:443/v1#https://127.0.0.1:443/v1</span>
</span><span class='line'>
</span><span class='line'><span class="k">[filter:healthcheck]</span>
</span><span class='line'><span class="na">use</span> <span class="o">=</span> <span class="s">egg:swift#healthcheck</span>
</span><span class='line'>
</span><span class='line'><span class="k">[filter:cache]</span>
</span><span class='line'><span class="na">use</span> <span class="o">=</span> <span class="s">egg:swift#memcache</span>
</span><span class='line'><span class="na">memcache_servers</span> <span class="o">=</span> <span class="s">10.0.0.0:11211</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we create the rings.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">cd</span> <span class="err">/etc/swift</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">account.builder</span> <span class="err">create</span> <span class="err">18</span> <span class="err">3</span> <span class="err">1</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">container.builder</span> <span class="err">create</span> <span class="err">18</span> <span class="err">3</span> <span class="err">1</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">object.builder</span> <span class="err">create</span> <span class="err">18</span> <span class="err">3</span> <span class="err">1</span>
</span></code></pre></td></tr></table></div></figure>


<p>And set the owner back to swift.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">sudo</span> <span class="err">chown</span> <span class="err">-R</span> <span class="err">swift:swift</span> <span class="err">/etc/swift</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is it for now. We&#8217;ll set up the storage nodes first before coming back to the proxy server.</p>

<h2>Setting up the Swift Storage nodes</h2>

<p>Unlike what Amar proposed, there is no need to keep the instances under the same availability zone. Ideally the storage nodes should be in different regions to prevent multiple failures. For our case, we are setting up everything in the same region for convenience.</p>

<p>We are going to add EBS volumes to mimic hard drives. Create a new EBS volume for each storage server and attach them. You may use the default value of <strong>/dev/sdf</strong> for <strong>Device</strong>. They will be renamed to <strong>/dev/xvdf</strong> in your instance.</p>

<p>The storage node contain the account, container and object servers. Install the dependencies.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">sudo</span> <span class="err">apt-get</span> <span class="err">install</span> <span class="err">swift-account</span> <span class="err">swift-container</span> <span class="err">swift-object</span> <span class="err">xfsprogs</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next we want to set up the partition.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">sudo</span> <span class="err">fdisk</span> <span class="err">/dev/xvdf</span>
</span></code></pre></td></tr></table></div></figure>


<p>FDisk will be prompt you for the values. You may follow the responses in order</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">n</span>
</span><span class='line'><span class="err">p</span>
</span><span class='line'><span class="err">1</span>
</span><span class='line'><span class="err">Enter</span>
</span><span class='line'><span class="err">Enter</span>
</span><span class='line'><span class="err">w</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next we build the <a href="http://en.wikipedia.org/wiki/XFS">XFS</a> file system within the partition.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="na">sudo mkfs.xfs -i size</span><span class="o">=</span><span class="s">1024 /dev/xvdf1</span>
</span></code></pre></td></tr></table></div></figure>


<p>Append the following line to <strong>/etc/fstab</strong></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="na">/dev/xvdf1 /srv/node/xvdf1 xfs noatime,nodiratime,nobarrier,logbufs</span><span class="o">=</span><span class="s">8 0 0</span>
</span></code></pre></td></tr></table></div></figure>


<p>We mount it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">sudo</span> <span class="err">mkdir</span> <span class="err">-p</span> <span class="err">/srv/node/xvdf1</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">mount</span> <span class="err">/srv/node/xvdf1</span>
</span></code></pre></td></tr></table></div></figure>


<p>And change the owner to swift.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">sudo</span> <span class="err">chown</span> <span class="err">-R</span> <span class="err">swift:swift</span> <span class="err">/srv/node</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Rsync</h3>

<p>We need to configure <a href="http://en.wikipedia.org/wiki/Rsync">rsync</a> as well. Create <strong>/etc/rsyncd.conf</strong>. Add the following to the file. <strong>STORAGE_LOCAL_NET_IP</strong> is the IP address of the instance. Change it accordingly.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="na">uid</span> <span class="o">=</span> <span class="s">swift</span>
</span><span class='line'><span class="na">gid</span> <span class="o">=</span> <span class="s">swift</span>
</span><span class='line'><span class="na">log file</span> <span class="o">=</span> <span class="s">/var/log/rsyncd.log</span>
</span><span class='line'><span class="na">pid file</span> <span class="o">=</span> <span class="s">/var/run/rsyncd.pid</span>
</span><span class='line'><span class="na">address</span> <span class="o">=</span> <span class="s">&lt;STORAGE_LOCAL_NET_IP&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">[account]</span>
</span><span class='line'><span class="na">max connections</span> <span class="o">=</span> <span class="s">2</span>
</span><span class='line'><span class="na">path</span> <span class="o">=</span> <span class="s">/srv/node/</span>
</span><span class='line'><span class="na">read only</span> <span class="o">=</span> <span class="s">false</span>
</span><span class='line'><span class="na">lock file</span> <span class="o">=</span> <span class="s">/var/lock/account.lock</span>
</span><span class='line'>
</span><span class='line'><span class="k">[container]</span>
</span><span class='line'><span class="na">max connections</span> <span class="o">=</span> <span class="s">2</span>
</span><span class='line'><span class="na">path</span> <span class="o">=</span> <span class="s">/srv/node/</span>
</span><span class='line'><span class="na">read only</span> <span class="o">=</span> <span class="s">false</span>
</span><span class='line'><span class="na">lock file</span> <span class="o">=</span> <span class="s">/var/lock/container.lock</span>
</span><span class='line'>
</span><span class='line'><span class="k">[object]</span>
</span><span class='line'><span class="na">max connections</span> <span class="o">=</span> <span class="s">2</span>
</span><span class='line'><span class="na">path</span> <span class="o">=</span> <span class="s">/srv/node/</span>
</span><span class='line'><span class="na">read only</span> <span class="o">=</span> <span class="s">false</span>
</span><span class='line'><span class="na">lock file</span> <span class="o">=</span> <span class="s">/var/lock/object.lock</span>
</span></code></pre></td></tr></table></div></figure>


<p>Enable rsync in the rsync configuration at <strong>/etc/default/rsync</strong>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="na">RSYNC_ENABLE</span> <span class="o">=</span> <span class="s">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>And start rsync</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">service</span> <span class="err">rsync</span> <span class="err">start</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Account/Container/Object server configurations</h3>

<p>Next we need to set the IP address for the account, container and object server configuration files. Use the instance&#8217;s IP address for <strong>STORAGE_LOCAL_NET_IP</strong>.</p>

<p>The account server&#8217;s configuration file is at <strong>/etc/swift/account-server.conf</strong>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="k">[DEFAULT]</span>
</span><span class='line'><span class="na">bind_ip</span> <span class="o">=</span> <span class="s">&lt;STORAGE_LOCAL_NET_IP&gt;</span>
</span><span class='line'><span class="na">workers</span> <span class="o">=</span> <span class="s">2</span>
</span><span class='line'>
</span><span class='line'><span class="k">[pipeline:main]</span>
</span><span class='line'><span class="na">pipeline</span> <span class="o">=</span> <span class="s">account-server</span>
</span><span class='line'>
</span><span class='line'><span class="k">[app:account-server]</span>
</span><span class='line'><span class="na">use</span> <span class="o">=</span> <span class="s">egg:swift#account</span>
</span><span class='line'>
</span><span class='line'><span class="k">[account-replicator]</span>
</span><span class='line'>
</span><span class='line'><span class="k">[account-auditor]</span>
</span><span class='line'>
</span><span class='line'><span class="k">[account-reaper]</span>
</span></code></pre></td></tr></table></div></figure>


<p>The container server&#8217;s configuration file is at <strong>/etc/swift/container-server.conf</strong>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="k">[DEFAULT]</span>
</span><span class='line'><span class="na">bind_ip</span> <span class="o">=</span> <span class="s">&lt;STORAGE_LOCAL_NET_IP&gt;</span>
</span><span class='line'><span class="na">workers</span> <span class="o">=</span> <span class="s">2</span>
</span><span class='line'>
</span><span class='line'><span class="k">[pipeline:main]</span>
</span><span class='line'><span class="na">pipeline</span> <span class="o">=</span> <span class="s">container-server</span>
</span><span class='line'>
</span><span class='line'><span class="k">[app:container-server]</span>
</span><span class='line'><span class="na">use</span> <span class="o">=</span> <span class="s">egg:swift#container</span>
</span><span class='line'>
</span><span class='line'><span class="k">[container-replicator]</span>
</span><span class='line'>
</span><span class='line'><span class="k">[container-updater]</span>
</span><span class='line'>
</span><span class='line'><span class="k">[container-auditor]</span>
</span></code></pre></td></tr></table></div></figure>


<p>The object server&#8217;s configuration file is at <strong>/etc/swift/object-server.conf</strong>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="k">[DEFAULT]</span>
</span><span class='line'><span class="na">bind_ip</span> <span class="o">=</span> <span class="s">&lt;STORAGE_LOCAL_NET_IP&gt;</span>
</span><span class='line'><span class="na">workers</span> <span class="o">=</span> <span class="s">2</span>
</span><span class='line'>
</span><span class='line'><span class="k">[pipeline:main]</span>
</span><span class='line'><span class="na">pipeline</span> <span class="o">=</span> <span class="s">object-server</span>
</span><span class='line'>
</span><span class='line'><span class="k">[app:object-server]</span>
</span><span class='line'><span class="na">use</span> <span class="o">=</span> <span class="s">egg:swift#object</span>
</span><span class='line'>
</span><span class='line'><span class="k">[object-replicator]</span>
</span><span class='line'>
</span><span class='line'><span class="k">[object-updater]</span>
</span><span class='line'>
</span><span class='line'><span class="k">[object-auditor]</span>
</span></code></pre></td></tr></table></div></figure>


<p>Repeat these steps for the rest of the storage nodes.</p>

<h2>Starting the servers</h2>

<p>Let&#8217;s go back to the proxy server. We are going to create a script to build the rings. Create a file at <strong>/etc/swift/build_rings.sh</strong>. Replace the IP address accordingly.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="c1">#!/bin/sh</span>
</span><span class='line'><span class="na">export ZONE</span><span class="o">=</span><span class="s">1                  # set the zone number for that storage device</span>
</span><span class='line'><span class="na">export STORAGE_LOCAL_NET_IP</span><span class="o">=</span><span class="s">10.0.0.1   # and the IP address</span>
</span><span class='line'><span class="na">export WEIGHT</span><span class="o">=</span><span class="s">100               # relative weight (higher for bigger/faster disks)</span>
</span><span class='line'><span class="na">export DEVICE</span><span class="o">=</span><span class="s">sdf1</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">account.builder</span> <span class="err">add</span> <span class="err">z$ZONE-$STORAGE_LOCAL_NET_IP:6002/$DEVICE</span> <span class="err">$WEIGHT</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">container.builder</span> <span class="err">add</span> <span class="err">z$ZONE-$STORAGE_LOCAL_NET_IP:6001/$DEVICE</span> <span class="err">$WEIGHT</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">object.builder</span> <span class="err">add</span> <span class="err">z$ZONE-$STORAGE_LOCAL_NET_IP:6000/$DEVICE</span> <span class="err">$WEIGHT</span>
</span><span class='line'>
</span><span class='line'><span class="na">export ZONE</span><span class="o">=</span><span class="s">2                  # set the zone number for that storage device</span>
</span><span class='line'><span class="na">export STORAGE_LOCAL_NET_IP</span><span class="o">=</span><span class="s">10.0.0.2   # and the IP address</span>
</span><span class='line'><span class="na">export WEIGHT</span><span class="o">=</span><span class="s">100               # relative weight (higher for bigger/faster disks</span>
</span><span class='line'><span class="na">export DEVICE</span><span class="o">=</span><span class="s">sdf1</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">account.builder</span> <span class="err">add</span> <span class="err">z$ZONE-$STORAGE_LOCAL_NET_IP:6002/$DEVICE</span> <span class="err">$WEIGHT</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">container.builder</span> <span class="err">add</span> <span class="err">z$ZONE-$STORAGE_LOCAL_NET_IP:6001/$DEVICE</span> <span class="err">$WEIGHT</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">object.builder</span> <span class="err">add</span> <span class="err">z$ZONE-$STORAGE_LOCAL_NET_IP:6000/$DEVICE</span> <span class="err">$WEIGHT</span>
</span><span class='line'>
</span><span class='line'><span class="na">export ZONE</span><span class="o">=</span><span class="s">3                  # set the zone number for that storage device</span>
</span><span class='line'><span class="na">export STORAGE_LOCAL_NET_IP</span><span class="o">=</span><span class="s">10.0.0.3   # and the IP address</span>
</span><span class='line'><span class="na">export WEIGHT</span><span class="o">=</span><span class="s">100               # relative weight (higher for bigger/faster disks)</span>
</span><span class='line'><span class="na">export DEVICE</span><span class="o">=</span><span class="s">sdf1</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">account.builder</span> <span class="err">add</span> <span class="err">z$ZONE-$STORAGE_LOCAL_NET_IP:6002/$DEVICE</span> <span class="err">$WEIGHT</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">container.builder</span> <span class="err">add</span> <span class="err">z$ZONE-$STORAGE_LOCAL_NET_IP:6001/$DEVICE</span> <span class="err">$WEIGHT</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">object.builder</span> <span class="err">add</span> <span class="err">z$ZONE-$STORAGE_LOCAL_NET_IP:6000/$DEVICE</span> <span class="err">$WEIGHT</span>
</span><span class='line'>
</span><span class='line'><span class="na">export ZONE</span><span class="o">=</span><span class="s">4                  # set the zone number for that storage device</span>
</span><span class='line'><span class="na">export STORAGE_LOCAL_NET_IP</span><span class="o">=</span><span class="s">10.0.0.4   # and the IP address</span>
</span><span class='line'><span class="na">export WEIGHT</span><span class="o">=</span><span class="s">100               # relative weight (higher for bigger/faster disks</span>
</span><span class='line'><span class="na">export DEVICE</span><span class="o">=</span><span class="s">sdf1</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">account.builder</span> <span class="err">add</span> <span class="err">z$ZONE-$STORAGE_LOCAL_NET_IP:6002/$DEVICE</span> <span class="err">$WEIGHT</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">container.builder</span> <span class="err">add</span> <span class="err">z$ZONE-$STORAGE_LOCAL_NET_IP:6001/$DEVICE</span> <span class="err">$WEIGHT</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">object.builder</span> <span class="err">add</span> <span class="err">z$ZONE-$STORAGE_LOCAL_NET_IP:6000/$DEVICE</span> <span class="err">$WEIGHT</span>
</span><span class='line'>
</span><span class='line'><span class="na">export ZONE</span><span class="o">=</span><span class="s">5                  # set the zone number for that storage device</span>
</span><span class='line'><span class="na">export STORAGE_LOCAL_NET_IP</span><span class="o">=</span><span class="s">10.0.0.5   # and the IP address</span>
</span><span class='line'><span class="na">export WEIGHT</span><span class="o">=</span><span class="s">100               # relative weight (higher for bigger/faster disks</span>
</span><span class='line'><span class="na">export DEVICE</span><span class="o">=</span><span class="s">sdf1</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">account.builder</span> <span class="err">add</span> <span class="err">z$ZONE-$STORAGE_LOCAL_NET_IP:6002/$DEVICE</span> <span class="err">$WEIGHT</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">container.builder</span> <span class="err">add</span> <span class="err">z$ZONE-$STORAGE_LOCAL_NET_IP:6001/$DEVICE</span> <span class="err">$WEIGHT</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">object.builder</span> <span class="err">add</span> <span class="err">z$ZONE-$STORAGE_LOCAL_NET_IP:6000/$DEVICE</span> <span class="err">$WEIGHT</span>
</span></code></pre></td></tr></table></div></figure>


<p>Make the script executable and run it.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">sudo</span> <span class="err">chmod</span> <span class="err">+x</span> <span class="err">/etc/swift/build_rings.sh</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">/etc/swift/build_rings.sh</span>
</span></code></pre></td></tr></table></div></figure>


<p>We continue the build the rings.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">account.builder</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">container.builder</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">object.builder</span>
</span></code></pre></td></tr></table></div></figure>


<p>And rebalance them.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">account.builder</span> <span class="err">rebalance</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">container.builder</span> <span class="err">rebalance</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-ring-builder</span> <span class="err">object.builder</span> <span class="err">rebalance</span>
</span></code></pre></td></tr></table></div></figure>


<p>Copy your instance&#8217;s private key(the key file which you use for sshing in to your instance) to the proxy server. I&#8217;m assuming it is <strong>private_key.pem</strong>. Change the permission of <strong>private_key.pem</strong> to <strong>0600</strong>.</p>

<p>Next we need to propagate the ring files to all the storage nodes</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">scp</span> <span class="err">-i</span> <span class="err">private_key.pem</span> <span class="err">/etc/swift/*.gz</span> <span class="err">ubuntu@10.0.0.1:/etc/swift</span>
</span><span class='line'><span class="err">scp</span> <span class="err">-i</span> <span class="err">private_key.pem</span> <span class="err">/etc/swift/*.gz</span> <span class="err">ubuntu@10.0.0.2:/etc/swift</span>
</span><span class='line'><span class="err">scp</span> <span class="err">-i</span> <span class="err">private_key.pem</span> <span class="err">/etc/swift/*.gz</span> <span class="err">ubuntu@10.0.0.3:/etc/swift</span>
</span><span class='line'><span class="err">scp</span> <span class="err">-i</span> <span class="err">private_key.pem</span> <span class="err">/etc/swift/*.gz</span> <span class="err">ubuntu@10.0.0.4:/etc/swift</span>
</span><span class='line'><span class="err">scp</span> <span class="err">-i</span> <span class="err">private_key.pem</span> <span class="err">/etc/swift/*.gz</span> <span class="err">ubuntu@10.0.0.5:/etc/swift</span>
</span></code></pre></td></tr></table></div></figure>


<p>Log in to each of the storage node and run these commands.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">cd</span> <span class="err">/etc/swift</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">chown</span> <span class="err">-R</span> <span class="err">swift:swift</span> <span class="err">/etc/swift</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-init</span> <span class="err">all</span> <span class="err">start</span>
</span></code></pre></td></tr></table></div></figure>


<p>Your storage node should be running!</p>

<p>Now we need to start the proxy server. Log into the proxy server and run these commands.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">sudo</span> <span class="err">chown</span> <span class="err">-R</span> <span class="err">swift:swift</span> <span class="err">/etc/swift</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swift-init</span> <span class="err">proxy</span> <span class="err">start</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Setting the authentication</h3>

<p>We need to create the user for authentication.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">sudo</span> <span class="err">swauth-prep</span> <span class="err">-K</span> <span class="err">swauthkey</span> <span class="err">-A</span> <span class="err">https://127.0.0.1/auth/</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">swauth-add-user</span> <span class="err">-K</span> <span class="err">swauthkey</span> <span class="err">-A</span> <span class="err">https://127.0.0.1/auth/</span> <span class="err">-a</span> <span class="err">test</span> <span class="err">tester</span> <span class="err">testing</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Using the Swift cluster</h2>

<p>We have chosen to use another EC2 instance to act as a Swift client. As usual, create an instance and run the following commands.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">sudo</span> <span class="err">add-apt-repository</span> <span class="err">ppa:swift-core/release</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">apt-get</span> <span class="err">update</span>
</span><span class='line'><span class="err">sudo</span> <span class="err">apt-get</span> <span class="err">install</span> <span class="err">swift</span>
</span></code></pre></td></tr></table></div></figure>


<p>We need to obtain the authentication token first. As usual, replace the url with your own.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">curl</span> <span class="err">-k</span> <span class="err">-v</span> <span class="err">-H</span> <span class="err">&#39;X-Storage-User:</span> <span class="err">test:tester&#39;</span> <span class="err">-H</span> <span class="err">&#39;X-Storage-Pass:</span> <span class="err">testing&#39;</span> <span class="err">https://ec2-1-2-3-4.compute-1.amazonaws.com/auth/v1.0</span>
</span></code></pre></td></tr></table></div></figure>


<p>You should get this output</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">*</span> <span class="err">About</span> <span class="err">to</span> <span class="err">connect()</span> <span class="err">to</span> <span class="err">ec2-1-2-3-4.compute-1.amazonaws.com</span> <span class="err">port</span> <span class="err">443</span> <span class="err">(</span><span class="c1">#0)</span>
</span><span class='line'><span class="err">*</span>   <span class="err">Trying</span> <span class="err">10.0.0.1...</span> <span class="err">connected</span>
</span><span class='line'><span class="err">*</span> <span class="err">successfully</span> <span class="err">set</span> <span class="err">certificate</span> <span class="err">verify</span> <span class="err">locations:</span>
</span><span class='line'><span class="err">*</span>   <span class="err">CAfile:</span> <span class="err">none</span>
</span><span class='line'>  <span class="err">CApath:</span> <span class="err">/etc/ssl/certs</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">handshake,</span> <span class="err">Client</span> <span class="err">hello</span> <span class="err">(1):</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">handshake,</span> <span class="err">Server</span> <span class="err">hello</span> <span class="err">(2):</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">handshake,</span> <span class="err">CERT</span> <span class="err">(11):</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">handshake,</span> <span class="err">Server</span> <span class="err">finished</span> <span class="err">(14):</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">handshake,</span> <span class="err">Client</span> <span class="err">key</span> <span class="err">exchange</span> <span class="err">(16):</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">change</span> <span class="err">cipher,</span> <span class="err">Client</span> <span class="err">hello</span> <span class="err">(1):</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">handshake,</span> <span class="err">Finished</span> <span class="err">(20):</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">change</span> <span class="err">cipher,</span> <span class="err">Client</span> <span class="err">hello</span> <span class="err">(1):</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">handshake,</span> <span class="err">Finished</span> <span class="err">(20):</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSL</span> <span class="err">connection</span> <span class="err">using</span> <span class="err">AES256-SHA</span>
</span><span class='line'><span class="err">*</span> <span class="err">Server</span> <span class="err">certificate:</span>
</span><span class='line'><span class="na">*        subject: C</span><span class="o">=</span><span class="s">AU; ST=Some-State; O=Internet Widgits Pty Ltd</span>
</span><span class='line'><span class="err">*</span>        <span class="err">start</span> <span class="err">date:</span> <span class="err">2013-01-23</span> <span class="err">06:24:57</span> <span class="err">GMT</span>
</span><span class='line'><span class="err">*</span>        <span class="err">expire</span> <span class="err">date:</span> <span class="err">2013-02-22</span> <span class="err">06:24:57</span> <span class="err">GMT</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSL:</span> <span class="err">unable</span> <span class="err">to</span> <span class="err">obtain</span> <span class="err">common</span> <span class="err">name</span> <span class="err">from</span> <span class="err">peer</span> <span class="err">certificate</span>
</span><span class='line'><span class="err">&gt;</span> <span class="err">GET</span> <span class="err">/auth/v1.0</span> <span class="err">HTTP/1.1</span>
</span><span class='line'><span class="err">&gt;</span> <span class="err">User-Agent:</span> <span class="err">curl/7.22.0</span> <span class="err">(x86_64-pc-linux-gnu)</span> <span class="err">libcurl/7.22.0</span> <span class="err">OpenSSL/1.0.1</span> <span class="err">zlib/1.2.3.4</span> <span class="err">libidn/1.23</span> <span class="err">librtmp/2.3</span>
</span><span class='line'><span class="err">&gt;</span> <span class="err">Host:</span> <span class="err">ec2-1-2-3-4.compute-1.amazonaws.com</span>
</span><span class='line'><span class="err">&gt;</span> <span class="err">Accept:</span> <span class="err">*/*</span>
</span><span class='line'><span class="err">&gt;</span> <span class="err">X-Storage-User:</span> <span class="err">test:tester</span>
</span><span class='line'><span class="err">&gt;</span> <span class="err">X-Storage-Pass:</span> <span class="err">testing</span>
</span><span class='line'><span class="err">&gt;</span>
</span><span class='line'><span class="err">&lt;</span> <span class="err">HTTP/1.1</span> <span class="err">200</span> <span class="err">OK</span>
</span><span class='line'><span class="err">&lt;</span> <span class="err">X-Storage-Url:</span> <span class="err">https://ec2-1-2-3-4.compute-1.amazonaws.com:443/v1/AUTH_f1e9d209-4543-4907-8ae3-98f24e0b051f</span>
</span><span class='line'><span class="err">&lt;</span> <span class="err">X-Storage-Token:</span> <span class="err">AUTH_tkd26a954e86534b9498f1b196fdb60ac2</span>
</span><span class='line'><span class="err">&lt;</span> <span class="err">X-Auth-Token:</span> <span class="err">AUTH_tkd26a954e86534b9498f1b196fdb60ac2</span>
</span><span class='line'><span class="err">&lt;</span> <span class="err">Content-Length:</span> <span class="err">155</span>
</span><span class='line'><span class="err">&lt;</span> <span class="err">Date:</span> <span class="err">Thu,</span> <span class="err">24</span> <span class="err">Jan</span> <span class="err">2013</span> <span class="err">03:59:09</span> <span class="err">GMT</span>
</span><span class='line'><span class="err">&lt;</span>
</span><span class='line'><span class="err">*</span> <span class="err">Connection</span> <span class="c1">#0 to host ec2-1-2-3-4.compute-1.amazonaws.com left intact</span>
</span><span class='line'><span class="err">*</span> <span class="err">Closing</span> <span class="err">connection</span> <span class="c1">#0</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">alert,</span> <span class="err">Client</span> <span class="err">hello</span> <span class="err">(1):</span>
</span><span class='line'><span class="err">{&quot;storage&quot;:</span> <span class="err">{&quot;cluster_name&quot;:</span> <span class="err">&quot;https://ec2-1-2-3-4.compute-1.amazonaws.com:443/v1/AUTH_f1e9d209-4543-4907-8ae3-98f24e0b051f&quot;,</span> <span class="err">&quot;default&quot;:</span> <span class="err">&quot;cluster_name&quot;}}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next we make a request with the authentication token.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">curl</span> <span class="err">-k</span> <span class="err">-v</span> <span class="err">-H</span> <span class="err">&#39;X-Auth-Token:</span> <span class="err">AUTH_tkd26a954e86534b9498f1b196fdb60ac2&#39;</span> <span class="err">https://ec2-184-73-4-50.compute-1.amazonaws.com:443/v1/AUTH_f1e9d209-4543-4907-8ae3-98f24e0b051f</span>
</span></code></pre></td></tr></table></div></figure>


<p>You should get this output.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">*</span> <span class="err">About</span> <span class="err">to</span> <span class="err">connect()</span> <span class="err">to</span> <span class="err">ec2-1-2-3-4.compute-1.amazonaws.com</span> <span class="err">port</span> <span class="err">443</span> <span class="err">(</span><span class="c1">#0)</span>
</span><span class='line'><span class="err">*</span>   <span class="err">Trying</span> <span class="err">10.0.0.1...</span> <span class="err">connected</span>
</span><span class='line'><span class="err">*</span> <span class="err">successfully</span> <span class="err">set</span> <span class="err">certificate</span> <span class="err">verify</span> <span class="err">locations:</span>
</span><span class='line'><span class="err">*</span>   <span class="err">CAfile:</span> <span class="err">none</span>
</span><span class='line'>  <span class="err">CApath:</span> <span class="err">/etc/ssl/certs</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">handshake,</span> <span class="err">Client</span> <span class="err">hello</span> <span class="err">(1):</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">handshake,</span> <span class="err">Server</span> <span class="err">hello</span> <span class="err">(2):</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">handshake,</span> <span class="err">CERT</span> <span class="err">(11):</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">handshake,</span> <span class="err">Server</span> <span class="err">finished</span> <span class="err">(14):</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">handshake,</span> <span class="err">Client</span> <span class="err">key</span> <span class="err">exchange</span> <span class="err">(16):</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">change</span> <span class="err">cipher,</span> <span class="err">Client</span> <span class="err">hello</span> <span class="err">(1):</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">handshake,</span> <span class="err">Finished</span> <span class="err">(20):</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">change</span> <span class="err">cipher,</span> <span class="err">Client</span> <span class="err">hello</span> <span class="err">(1):</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">handshake,</span> <span class="err">Finished</span> <span class="err">(20):</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSL</span> <span class="err">connection</span> <span class="err">using</span> <span class="err">AES256-SHA</span>
</span><span class='line'><span class="err">*</span> <span class="err">Server</span> <span class="err">certificate:</span>
</span><span class='line'><span class="na">*        subject: C</span><span class="o">=</span><span class="s">AU; ST=Some-State; O=Internet Widgits Pty Ltd</span>
</span><span class='line'><span class="err">*</span>        <span class="err">start</span> <span class="err">date:</span> <span class="err">2013-01-23</span> <span class="err">06:24:57</span> <span class="err">GMT</span>
</span><span class='line'><span class="err">*</span>        <span class="err">expire</span> <span class="err">date:</span> <span class="err">2013-02-22</span> <span class="err">06:24:57</span> <span class="err">GMT</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSL:</span> <span class="err">unable</span> <span class="err">to</span> <span class="err">obtain</span> <span class="err">common</span> <span class="err">name</span> <span class="err">from</span> <span class="err">peer</span> <span class="err">certificate</span>
</span><span class='line'><span class="err">&gt;</span> <span class="err">GET</span> <span class="err">/v1/AUTH_f1e9d209-4543-4907-8ae3-98f24e0b051f</span> <span class="err">HTTP/1.1</span>
</span><span class='line'><span class="err">&gt;</span> <span class="err">User-Agent:</span> <span class="err">curl/7.22.0</span> <span class="err">(x86_64-pc-linux-gnu)</span> <span class="err">libcurl/7.22.0</span> <span class="err">OpenSSL/1.0.1</span> <span class="err">zlib/1.2.3.4</span> <span class="err">libidn/1.23</span> <span class="err">librtmp/2.3</span>
</span><span class='line'><span class="err">&gt;</span> <span class="err">Host:</span> <span class="err">ec2-1-2-3-4.compute-1.amazonaws.com</span>
</span><span class='line'><span class="err">&gt;</span> <span class="err">Accept:</span> <span class="err">*/*</span>
</span><span class='line'><span class="err">&gt;</span> <span class="err">X-Auth-Token:</span> <span class="err">AUTH_tkd26a954e86534b9498f1b196fdb60ac2</span>
</span><span class='line'><span class="err">&gt;</span>
</span><span class='line'><span class="err">&lt;</span> <span class="err">HTTP/1.1</span> <span class="err">204</span> <span class="err">No</span> <span class="err">Content</span>
</span><span class='line'><span class="err">&lt;</span> <span class="err">X-Account-Object-Count:</span> <span class="err">0</span>
</span><span class='line'><span class="err">&lt;</span> <span class="err">X-Account-Bytes-Used:</span> <span class="err">0</span>
</span><span class='line'><span class="err">&lt;</span> <span class="err">X-Account-Container-Count:</span> <span class="err">0</span>
</span><span class='line'><span class="err">&lt;</span> <span class="err">Accept-Ranges:</span> <span class="err">bytes</span>
</span><span class='line'><span class="err">&lt;</span> <span class="err">Content-Length:</span> <span class="err">0</span>
</span><span class='line'><span class="err">&lt;</span> <span class="err">Date:</span> <span class="err">Thu,</span> <span class="err">24</span> <span class="err">Jan</span> <span class="err">2013</span> <span class="err">04:00:47</span> <span class="err">GMT</span>
</span><span class='line'><span class="err">&lt;</span>
</span><span class='line'><span class="err">*</span> <span class="err">Connection</span> <span class="c1">#0 to host ec2-1-2-3-4.compute-1.amazonaws.com left intact</span>
</span><span class='line'><span class="err">*</span> <span class="err">Closing</span> <span class="err">connection</span> <span class="c1">#0</span>
</span><span class='line'><span class="err">*</span> <span class="err">SSLv3,</span> <span class="err">TLS</span> <span class="err">alert,</span> <span class="err">Client</span> <span class="err">hello</span> <span class="err">(1):</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we are able to use our Swift store. The <strong>stat</strong> command shows you what is on the server.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">swift</span> <span class="err">-A</span> <span class="err">https://ec2-1-2-3-4.compute-1.amazonaws.com/auth/v1.0</span> <span class="err">-U</span> <span class="err">test:tester</span> <span class="err">-K</span> <span class="err">testing</span> <span class="err">stat</span>
</span></code></pre></td></tr></table></div></figure>


<p>Have a look at the options available with the help option.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">swift</span> <span class="err">-h</span>
</span></code></pre></td></tr></table></div></figure>


<p>Try uploading a file with the <strong>upload</strong> command.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ini'><span class='line'><span class="err">swift</span> <span class="err">-A</span> <span class="err">https://ec2-1-2-3-4.compute-1.amazonaws.com/auth/v1.0</span> <span class="err">-U</span> <span class="err">test1:tester1</span> <span class="err">-K</span> <span class="err">testing</span> <span class="err">upload</span> <span class="err">test</span> <span class="err">foo.gz</span>
</span></code></pre></td></tr></table></div></figure>


<p>And there you go, a working swift cluster. Please let us know if there are any mistakes. Thanks!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">DropMyEmail</span></span>

      








  


<time datetime="2013-01-24T12:19:00+08:00" pubdate data-updated="true">Jan 24<span>th</span>, 2013</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://engineering.dropmyemail.com/blog/2013/01/24/how-to-install-openstack-swift-on-amazon-aws/" data-via="" data-counturl="http://engineering.dropmyemail.com/blog/2013/01/24/how-to-install-openstack-swift-on-amazon-aws/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/01/24/how-to-install-openstack-swift-on-amazon-aws/">How to install Openstack Swift on Amazon AWS</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - DropMyEmail -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
